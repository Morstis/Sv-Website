rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
	 function getRole(rolle) {
   		 	return get(/databases/$(database)/documents/user/$(request.auth.uid)).data.rolle == rolle;
		  }


    match /modules {
      allow read, write: if false;
        match /nachhilfe {
         allow read: if request.auth != null && request.auth.token.email_verified;
         allow write: if request.auth != null && request.auth.token.email_verified && getRole("ADMIN") == true;
          match /user {
            allow read: if request.auth != null && request.auth.token.email_verified;
          }
          match /user/{userID} {
            allow read: if request.auth != null && request.auth.token.email_verified;
    	      allow update, create, delete: if request.auth != null && request.auth.uid == userID && request.auth.token.email_verified && getRole("USER") == true;
          }
          
        }
        match /admin/{document=**} {
         allow read: if true;
         allow write: if request.auth != null && request.auth.token.email_verified && getRole("ADMIN") == true;
        }
    }
    match /user/{userID} {
      allow read: if request.auth != null && request.auth.uid == userID && request.auth.token.email_verified;
      allow create: if request.auth != null && request.auth.uid == userID;
    }
  }
}
